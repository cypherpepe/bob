"use strict";(self.webpackChunkBOB_docs=self.webpackChunkBOB_docs||[]).push([[1934],{533:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var s=n(4848),r=n(8453);const i={},c="BitcoinTx",d={id:"contracts/src/src/bridge/BitcoinTx.sol/library.BitcoinTx",title:"BitcoinTx",description:"Git Source",source:"@site/docs/contracts/src/src/bridge/BitcoinTx.sol/library.BitcoinTx.md",sourceDirName:"contracts/src/src/bridge/BitcoinTx.sol",slug:"/contracts/src/src/bridge/BitcoinTx.sol/library.BitcoinTx",permalink:"/docs/contracts/src/src/bridge/BitcoinTx.sol/library.BitcoinTx",draft:!1,unlisted:!1,editUrl:"https://github.com/bob-collective/bob/tree/master/docs/docs/contracts/src/src/bridge/BitcoinTx.sol/library.BitcoinTx.md",tags:[],version:"current",frontMatter:{},sidebar:"contractSidebar",previous:{title:"TestingErc20",permalink:"/docs/contracts/src/src/TestingErc20.sol/contract.TestingErc20"},next:{title:"BridgeState",permalink:"/docs/contracts/src/src/bridge/BridgeState.sol/library.BridgeState"}},o={},l=[{value:"Functions",id:"functions",level:2},{value:"validateProof",id:"validateproof",level:3},{value:"evaluateProofDifficulty",id:"evaluateproofdifficulty",level:3},{value:"getTxOutputValue",id:"gettxoutputvalue",level:3},{value:"getTxOutputValue",id:"gettxoutputvalue-1",level:3},{value:"reverseEndianness",id:"reverseendianness",level:3},{value:"ensureTxInputSpendsUtxo",id:"ensuretxinputspendsutxo",level:3},{value:"Structs",id:"structs",level:2},{value:"Info",id:"info",level:3},{value:"Proof",id:"proof",level:3},{value:"UTXO",id:"utxo",level:3},{value:"TxOutputsProcessingInfo",id:"txoutputsprocessinginfo",level:3}];function a(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"bitcointx",children:"BitcoinTx"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://github.com/bob-collective/bob/blob/master/src/bridge/BitcoinTx.sol",children:"Git Source"})}),"\n",(0,s.jsx)(t.p,{children:"Allows to reference Bitcoin raw transaction in Solidity."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsxs)(t.em,{children:["See ",(0,s.jsx)(t.a,{href:"https://developer.bitcoin.org/reference/transactions.html#raw-transaction-format",children:"https://developer.bitcoin.org/reference/transactions.html#raw-transaction-format"})]})}),"\n",(0,s.jsx)(t.h2,{id:"functions",children:"Functions"}),"\n",(0,s.jsx)(t.h3,{id:"validateproof",children:"validateProof"}),"\n",(0,s.jsx)(t.p,{children:"Validates the SPV proof of the Bitcoin transaction.\nReverts in case the validation or proof verification fail."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-solidity",children:"function validateProof(BridgeState.Storage storage self, Info memory txInfo, Proof memory proof)\n    internal\n    view\n    returns (bytes32 txHash);\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Parameters"})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"self"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"BridgeState.Storage"})}),(0,s.jsx)(t.td,{})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"txInfo"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"Info"})}),(0,s.jsx)(t.td,{children:"Bitcoin transaction data."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"proof"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"Proof"})}),(0,s.jsx)(t.td,{children:"Bitcoin proof data."})]})]})]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Returns"})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"txHash"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"bytes32"})}),(0,s.jsx)(t.td,{children:"Proven 32-byte transaction hash."})]})})]}),"\n",(0,s.jsx)(t.h3,{id:"evaluateproofdifficulty",children:"evaluateProofDifficulty"}),"\n",(0,s.jsx)(t.p,{children:"Evaluates the given Bitcoin proof difficulty against the actual\nBitcoin chain difficulty provided by the relay oracle.\nReverts in case the evaluation fails."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-solidity",children:"function evaluateProofDifficulty(BridgeState.Storage storage self, bytes memory bitcoinHeaders) internal view;\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Parameters"})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"self"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"BridgeState.Storage"})}),(0,s.jsx)(t.td,{})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"bitcoinHeaders"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"bytes"})}),(0,s.jsx)(t.td,{children:"Bitcoin headers chain being part of the SPV proof. Used to extract the observed proof difficulty."})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"gettxoutputvalue",children:"getTxOutputValue"}),"\n",(0,s.jsx)(t.p,{children:"Processes the Bitcoin transaction output vector."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-solidity",children:"function getTxOutputValue(bytes32 scriptPubKeyHash, bytes memory txOutputVector) internal pure returns (uint64 value);\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Parameters"})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"scriptPubKeyHash"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"bytes32"})}),(0,s.jsx)(t.td,{children:"Expected Bitcoin scriptPubKey keccak256 hash."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"txOutputVector"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"bytes"})}),(0,s.jsxs)(t.td,{children:["Bitcoin transaction output vector. This function assumes vector's structure is valid so it must be validated using e.g. ",(0,s.jsx)(t.code,{children:"BTCUtils.validateVout"})," function before it is passed here."]})]})]})]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Returns"})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"value"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"uint64"})}),(0,s.jsx)(t.td,{children:"Outcomes of the processing."})]})})]}),"\n",(0,s.jsx)(t.h3,{id:"gettxoutputvalue-1",children:"getTxOutputValue"}),"\n",(0,s.jsx)(t.p,{children:"Processes all outputs from the transaction."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-solidity",children:"function getTxOutputValue(\n    bytes32 scriptPubKeyHash,\n    bytes memory txOutputVector,\n    TxOutputsProcessingInfo memory processInfo\n) internal pure returns (uint64 value);\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Parameters"})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"scriptPubKeyHash"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"bytes32"})}),(0,s.jsx)(t.td,{children:"Expected Bitcoin scriptPubKey keccak256 hash."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"txOutputVector"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"bytes"})}),(0,s.jsxs)(t.td,{children:["Bitcoin transaction output vector. This function assumes vector's structure is valid so it must be validated using e.g. ",(0,s.jsx)(t.code,{children:"BTCUtils.validateVout"})," function before it is passed here."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"processInfo"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"TxOutputsProcessingInfo"})}),(0,s.jsx)(t.td,{children:"TxOutputsProcessingInfo identifying output starting index and the number of outputs."})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"reverseendianness",children:"reverseEndianness"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-solidity",children:"function reverseEndianness(bytes32 b) internal pure returns (bytes32 txHash);\n"})}),"\n",(0,s.jsx)(t.h3,{id:"ensuretxinputspendsutxo",children:"ensureTxInputSpendsUtxo"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-solidity",children:"function ensureTxInputSpendsUtxo(bytes memory _vin, BitcoinTx.UTXO memory utxo) internal pure;\n"})}),"\n",(0,s.jsx)(t.h2,{id:"structs",children:"Structs"}),"\n",(0,s.jsx)(t.h3,{id:"info",children:"Info"}),"\n",(0,s.jsx)(t.p,{children:"Represents Bitcoin transaction data."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-solidity",children:"struct Info {\n    bytes4 version;\n    bytes inputVector;\n    bytes outputVector;\n    bytes4 locktime;\n}\n"})}),"\n",(0,s.jsx)(t.h3,{id:"proof",children:"Proof"}),"\n",(0,s.jsx)(t.p,{children:"Represents data needed to perform a Bitcoin SPV proof."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-solidity",children:"struct Proof {\n    bytes merkleProof;\n    uint256 txIndexInBlock;\n    bytes bitcoinHeaders;\n}\n"})}),"\n",(0,s.jsx)(t.h3,{id:"utxo",children:"UTXO"}),"\n",(0,s.jsx)(t.p,{children:"Represents info about an unspent transaction output."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-solidity",children:"struct UTXO {\n    bytes32 txHash;\n    uint32 txOutputIndex;\n    uint64 txOutputValue;\n}\n"})}),"\n",(0,s.jsx)(t.h3,{id:"txoutputsprocessinginfo",children:"TxOutputsProcessingInfo"}),"\n",(0,s.jsx)(t.p,{children:"Represents temporary information needed during the processing of\nthe Bitcoin transaction outputs. This structure is an internal one\nand should not be exported outside of the transaction processing code."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.em,{children:'Allows to mitigate "stack too deep" errors on EVM.'})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-solidity",children:"struct TxOutputsProcessingInfo {\n    uint256 outputStartingIndex;\n    uint256 outputsCount;\n}\n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>d});var s=n(6540);const r={},i=s.createContext(r);function c(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);