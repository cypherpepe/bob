"use strict";(self.webpackChunkBOB_docs=self.webpackChunkBOB_docs||[]).push([[7120],{1750:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>d,toc:()=>a});var r=t(4848),s=t(8453);const c={},i="PimlicoERC20Paymaster",d={id:"contracts/src/src/paymasters/AccountAbstraction/AATokenPaymaster.sol/contract.PimlicoERC20Paymaster",title:"PimlicoERC20Paymaster",description:"Git Source",source:"@site/docs/contracts/src/src/paymasters/AccountAbstraction/AATokenPaymaster.sol/contract.PimlicoERC20Paymaster.md",sourceDirName:"contracts/src/src/paymasters/AccountAbstraction/AATokenPaymaster.sol",slug:"/contracts/src/src/paymasters/AccountAbstraction/AATokenPaymaster.sol/contract.PimlicoERC20Paymaster",permalink:"/docs/contracts/src/src/paymasters/AccountAbstraction/AATokenPaymaster.sol/contract.PimlicoERC20Paymaster",draft:!1,unlisted:!1,editUrl:"https://github.com/bob-collective/bob/tree/master/docs/docs/contracts/src/src/paymasters/AccountAbstraction/AATokenPaymaster.sol/contract.PimlicoERC20Paymaster.md",tags:[],version:"current",frontMatter:{},sidebar:"contractSidebar",previous:{title:"Erc20Mintable",permalink:"/docs/contracts/src/src/faucet/Erc20Minter.sol/interface.Erc20Mintable"},next:{title:"SafeTransferLib",permalink:"/docs/contracts/src/src/paymasters/AccountAbstraction/SafeTransferLib.sol/library.SafeTransferLib"}},l={},a=[{value:"State Variables",id:"state-variables",level:2},{value:"priceDenominator",id:"pricedenominator",level:3},{value:"REFUND_POSTOP_COST",id:"refund_postop_cost",level:3},{value:"token",id:"token",level:3},{value:"tokenDecimals",id:"tokendecimals",level:3},{value:"tokenOracle",id:"tokenoracle",level:3},{value:"nativeAssetOracle",id:"nativeassetoracle",level:3},{value:"previousPrice",id:"previousprice",level:3},{value:"priceMarkup",id:"pricemarkup",level:3},{value:"priceUpdateThreshold",id:"priceupdatethreshold",level:3},{value:"Functions",id:"functions",level:2},{value:"constructor",id:"constructor",level:3},{value:"updateConfig",id:"updateconfig",level:3},{value:"withdrawToken",id:"withdrawtoken",level:3},{value:"updatePrice",id:"updateprice",level:3},{value:"_validatePaymasterUserOp",id:"_validatepaymasteruserop",level:3},{value:"_postOp",id:"_postop",level:3},{value:"fetchPrice",id:"fetchprice",level:3},{value:"Events",id:"events",level:2},{value:"ConfigUpdated",id:"configupdated",level:3},{value:"UserOperationSponsored",id:"useroperationsponsored",level:3}];function o(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"pimlicoerc20paymaster",children:"PimlicoERC20Paymaster"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/bob-collective/bob/blob/master/src/paymasters/AccountAbstraction/AATokenPaymaster.sol",children:"Git Source"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Inherits:"}),"\nBasePaymaster"]}),"\n",(0,r.jsx)(n.p,{children:"An ERC-4337 Paymaster contract by Pimlico which is able to sponsor gas fees in exchange for ERC20 tokens.\nThe contract refunds excess tokens if the actual gas cost is lower than the initially provided amount.\nIt also allows updating price configuration and withdrawing tokens by the contract owner.\nThe contract uses an Oracle to fetch the latest token prices."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Inherits from BasePaymaster."})}),"\n",(0,r.jsx)(n.h2,{id:"state-variables",children:"State Variables"}),"\n",(0,r.jsx)(n.h3,{id:"pricedenominator",children:"priceDenominator"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"uint256 public constant priceDenominator = 1e6;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"refund_postop_cost",children:"REFUND_POSTOP_COST"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"uint256 public constant REFUND_POSTOP_COST = 40000;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"token",children:"token"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"IERC20 public immutable token;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"tokendecimals",children:"tokenDecimals"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"uint256 public immutable tokenDecimals;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"tokenoracle",children:"tokenOracle"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"IOracle public immutable tokenOracle;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"nativeassetoracle",children:"nativeAssetOracle"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"IOracle public immutable nativeAssetOracle;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"previousprice",children:"previousPrice"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"uint192 public previousPrice;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pricemarkup",children:"priceMarkup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"uint32 public priceMarkup;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"priceupdatethreshold",children:"priceUpdateThreshold"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"uint32 public priceUpdateThreshold;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"functions",children:"Functions"}),"\n",(0,r.jsx)(n.h3,{id:"constructor",children:"constructor"}),"\n",(0,r.jsx)(n.p,{children:"Initializes the PimlicoERC20Paymaster contract with the given parameters."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"constructor(\n    IERC20 _token,\n    IEntryPoint _entryPoint,\n    IOracle _tokenOracle,\n    IOracle _nativeAssetOracle,\n    address _owner,\n    uint8 _tokenDecimals\n) BasePaymaster(_entryPoint);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_token"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"IERC20"})}),(0,r.jsx)(n.td,{children:"The ERC20 token used for transaction fee payments."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_entryPoint"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"IEntryPoint"})}),(0,r.jsx)(n.td,{children:"The EntryPoint contract used in the Account Abstraction infrastructure."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_tokenOracle"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"IOracle"})}),(0,r.jsx)(n.td,{children:"The Oracle contract used to fetch the latest token prices."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_nativeAssetOracle"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"IOracle"})}),(0,r.jsx)(n.td,{children:"The Oracle contract used to fetch the latest native asset (ETH, Matic, Avax, etc.) prices."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_owner"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"address"})}),(0,r.jsx)(n.td,{children:"The address that will be set as the owner of the contract."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_tokenDecimals"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"uint8"})}),(0,r.jsx)(n.td,{})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"updateconfig",children:"updateConfig"}),"\n",(0,r.jsx)(n.p,{children:"Updates the price markup and price update threshold configurations."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"function updateConfig(uint32 _priceMarkup, uint32 _updateThreshold) external onlyOwner;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_priceMarkup"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"uint32"})}),(0,r.jsx)(n.td,{children:"The new price markup percentage (1e6 = 100%)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_updateThreshold"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"uint32"})}),(0,r.jsx)(n.td,{children:"The new price update threshold percentage (1e6 = 100%)."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"withdrawtoken",children:"withdrawToken"}),"\n",(0,r.jsx)(n.p,{children:"Allows the contract owner to withdraw a specified amount of tokens from the contract."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"function withdrawToken(address to, uint256 amount) external onlyOwner;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"to"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"address"})}),(0,r.jsx)(n.td,{children:"The address to transfer the tokens to."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"amount"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"uint256"})}),(0,r.jsx)(n.td,{children:"The amount of tokens to transfer."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"updateprice",children:"updatePrice"}),"\n",(0,r.jsx)(n.p,{children:"Updates the token price by fetching the latest price from the Oracle."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"function updatePrice() external;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"_validatepaymasteruserop",children:"_validatePaymasterUserOp"}),"\n",(0,r.jsx)(n.p,{children:"Validates a paymaster user operation and calculates the required token amount for the transaction."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"function _validatePaymasterUserOp(UserOperation calldata userOp, bytes32, uint256 requiredPreFund)\n    internal\n    override\n    returns (bytes memory context, uint256 validationResult);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"userOp"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"UserOperation"})}),(0,r.jsx)(n.td,{children:"The user operation data."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"<none>"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"bytes32"})}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"requiredPreFund"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"uint256"})}),(0,r.jsx)(n.td,{children:"The amount of tokens required for pre-funding."})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Returns"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"context"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"bytes"})}),(0,r.jsx)(n.td,{children:"The context containing the token amount and user sender address (if applicable)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"validationResult"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"uint256"})}),(0,r.jsx)(n.td,{children:"A uint256 value indicating the result of the validation (always 0 in this implementation)."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"_postop",children:"_postOp"}),"\n",(0,r.jsx)(n.p,{children:"Performs post-operation tasks, such as updating the token price and refunding excess tokens."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"This function is called after a user operation has been executed or reverted."})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"function _postOp(PostOpMode mode, bytes calldata context, uint256 actualGasCost) internal override;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"mode"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"PostOpMode"})}),(0,r.jsx)(n.td,{children:"The post-operation mode (either successful or reverted)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"context"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"bytes"})}),(0,r.jsx)(n.td,{children:"The context containing the token amount and user sender address."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"actualGasCost"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"uint256"})}),(0,r.jsx)(n.td,{children:"The actual gas cost of the transaction."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"fetchprice",children:"fetchPrice"}),"\n",(0,r.jsx)(n.p,{children:"Fetches the latest price from the given Oracle."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"This function is used to get the latest price from the tokenOracle or nativeAssetOracle."})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"function fetchPrice(IOracle _oracle) internal view returns (uint192 price);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_oracle"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"IOracle"})}),(0,r.jsx)(n.td,{children:"The Oracle contract to fetch the price from."})]})})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Returns"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"price"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"uint192"})}),(0,r.jsx)(n.td,{children:"The latest price fetched from the Oracle."})]})})]}),"\n",(0,r.jsx)(n.h2,{id:"events",children:"Events"}),"\n",(0,r.jsx)(n.h3,{id:"configupdated",children:"ConfigUpdated"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"event ConfigUpdated(uint32 priceMarkup, uint32 updateThreshold);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"useroperationsponsored",children:"UserOperationSponsored"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-solidity",children:"event UserOperationSponsored(address indexed user, uint256 actualTokenNeeded, uint256 actualGasCost);\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>d});var r=t(6540);const s={},c=r.createContext(s);function i(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);